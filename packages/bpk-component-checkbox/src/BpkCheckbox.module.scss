/*
 * Backpack - Skyscanner's Design System
 *
 * Copyright 2016 Skyscanner Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@use '../../bpk-mixins/tokens';
@use '../../bpk-mixins/forms';
@use '../../bpk-mixins/utils';

.bpk-checkbox {
  // Override for Ark UI structure - use flexbox for proper layout
  display: flex;
  padding-left: 0; // Remove padding since control has its own margin
  align-items: flex-start;
  gap: 0; // Remove gap, margin is on control

  @include forms.bpk-checkbox;

  @include utils.bpk-rtl {
    padding-right: 0;
  }

  &--white {
    @include forms.bpk-checkbox--white;
  }

  &--disabled {
    @include forms.bpk-checkbox--disabled;

    &--white {
      color: tokens.$bpk-text-disabled-on-dark-day;
    }
  }

  &--invalid {
    @include forms.bpk-checkbox--invalid;
  }

  &__control {
    // Ark UI Control wrapper - contains the checkbox input visuals
    // This is the visible checkbox box
    position: relative;
    display: inline-block;
    width: tokens.bpk-spacing-lg() - (tokens.$bpk-one-pixel-rem * 4);
    height: tokens.bpk-spacing-lg() - (tokens.$bpk-one-pixel-rem * 4);
    margin-right: tokens.bpk-spacing-md();
    flex-shrink: 0; // Prevent checkbox from shrinking
    transition:
      border-color tokens.$bpk-duration-sm ease-in-out,
      background-color tokens.$bpk-duration-sm ease-in-out;
    border: (tokens.$bpk-one-pixel-rem * 3) solid tokens.$bpk-text-secondary-day;
    border-radius: (tokens.$bpk-one-pixel-rem * 4);
    background-color: tokens.$bpk-canvas-day;
    cursor: pointer;
    vertical-align: text-bottom;

    @include utils.bpk-rtl {
      margin-right: 0;
      margin-left: tokens.bpk-spacing-md();
    }

    // Checked state
    &[data-state='checked'],
    &[data-state='indeterminate'] {
      @include utils.bpk-themeable-property(
        background-color,
        --bpk-checkbox-checked-color,
        tokens.$bpk-core-accent-day
      );
      @include utils.bpk-themeable-property(
        border-color,
        --bpk-checkbox-checked-color,
        tokens.$bpk-core-accent-day
      );
    }

    // Focus state
    &[data-focus] {
      outline: tokens.$bpk-one-pixel-rem * 2 solid tokens.$bpk-core-accent-day;
      outline-offset: tokens.$bpk-one-pixel-rem * 2;
    }

    // Disabled state
    &[data-disabled] {
      border-color: tokens.$bpk-text-disabled-day;
      background-color: tokens.$bpk-canvas-contrast-day;
      cursor: not-allowed;
      opacity: 0.5;
    }
  }

  &__label {
    @include forms.bpk-checkbox__label;

    &--small {
      @include forms.bpk-checkbox__label--small;
    }
  }

  &__indicator {
    // Ark UI Indicator - checkmark or dash icon
    display: flex;
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;

    // Checkmark icon (shown when checked)
    &[data-state='checked']::before {
      position: absolute;
      top: 50%;
      left: 50%;
      content: '';
      width: tokens.bpk-spacing-md();
      height: tokens.bpk-spacing-sm();
      transform: translate(-50%, -60%) rotate(-45deg);
      border: solid tokens.$bpk-surface-default-day;
      border-width: 0 0 (tokens.$bpk-one-pixel-rem * 2)
        (tokens.$bpk-one-pixel-rem * 2);
    }

    // Dash icon (shown when indeterminate)
    &[data-state='indeterminate']::before {
      position: absolute;
      top: 50%;
      left: 50%;
      content: '';
      width: tokens.bpk-spacing-md();
      height: (tokens.$bpk-one-pixel-rem * 2);
      transform: translate(-50%, -50%);
      border-radius: tokens.$bpk-border-size-lg;
      background-color: tokens.$bpk-surface-default-day;
    }
  }

  &__input {
    @include forms.bpk-checkbox__input;

    &-indeterminate {
      &::before {
        position: absolute;
        top: tokens.bpk-spacing-sm() + tokens.$bpk-one-pixel-rem;
        left: tokens.bpk-spacing-sm() * 0.5;
        content: '';
        width: tokens.bpk-spacing-xxl() * 0.25;
        height: tokens.bpk-spacing-sm() - tokens.$bpk-one-pixel-rem;
        border-radius: tokens.$bpk-border-size-lg;
        background-color: tokens.$bpk-surface-default-day;
      }
    }

    &:disabled {
      cursor: inherit;
    }

    &-white {
      background-color: tokens.$bpk-surface-default-day;
    }
  }

  &__asterisk {
    color: tokens.$bpk-status-danger-spot-day;
  }
}
