/*
 * Backpack - Skyscanner's Design System
 *
 * Copyright 2016 Skyscanner Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@use '../../bpk-mixins/tokens';
@use '../../bpk-mixins/breakpoints';

// Spacing values map (Backpack tokens to rem values)
// Note: bpk-spacing-none() function doesn't exist, use variable or 0
$spacing-map: (
  'none': tokens.$bpk-spacing-none,
  // 0
  'sm': tokens.bpk-spacing-sm(),
  // 0.25rem (4px)
  'md': tokens.bpk-spacing-md(),
  // 0.5rem (8px)
  'base': tokens.bpk-spacing-base(),
  // 1rem (16px)
  'lg': tokens.bpk-spacing-lg(),
  // 1.5rem (24px)
  'xl': tokens.bpk-spacing-xl(),
  // 2rem (32px)
  'xxl': tokens.bpk-spacing-xxl(),
  // 2.5rem (40px)
  'xxxl': tokens.bpk-spacing-xxxl(),
  // 4rem (64px)
  'xxxxl': tokens.bpk-spacing-xxxxl(), // 6rem (96px)
);

// Helper function to get spacing value
@function get-spacing($token) {
  @if map-has-key($spacing-map, $token) {
    @return map-get($spacing-map, $token);
  }

  // If it's a number, assume it's a pixel value and convert to rem
  @if type-of($token) == number {
    @return #{$token / 16}rem;
  }

  @return $token;
}

// Generate spacing utility classes with bpk- prefix
@mixin generate-spacing-utilities($property, $prefix) {
  // Generate base utilities (no breakpoint)
  @each $token, $value in $spacing-map {
    .bpk-#{$prefix}-#{$token} {
      #{$property}: $value;
    }
  }

  // Generate responsive variants - classes are defined globally, media queries apply them
  // Mobile-first approach: smallMobile is base (no media query), others use min-width
  // This ensures proper cascading where later breakpoints override earlier ones
  @each $token, $value in $spacing-map {
    // smallMobile: base value, applies to all sizes (no media query)
    .bpk-#{$prefix}-#{$token}-smallMobile {
      #{$property}: $value;
    }

    // mobile: applies from mobile breakpoint and above (overrides smallMobile)
    .bpk-#{$prefix}-#{$token}-mobile {
      @include breakpoints.bpk-breakpoint-above-mobile {
        #{$property}: $value;
      }
    }

    // smallTablet: applies from smallTablet breakpoint and above (overrides mobile)
    .bpk-#{$prefix}-#{$token}-smallTablet {
      @include breakpoints.bpk-breakpoint-above-mobile {
        #{$property}: $value;
      }
    }

    // tablet: applies from tablet breakpoint and above (overrides smallTablet)
    .bpk-#{$prefix}-#{$token}-tablet {
      @include breakpoints.bpk-breakpoint-above-mobile {
        #{$property}: $value;
      }
    }

    // desktop: applies from desktop breakpoint and above (overrides tablet)
    .bpk-#{$prefix}-#{$token}-desktop {
      @include breakpoints.bpk-breakpoint-above-tablet {
        #{$property}: $value;
      }
    }
  }

  // Generate dynamic value classes using CSS variables
  // These classes use CSS variables set at runtime, avoiding inline styles
  // This provides zero runtime CSS generation for dynamic values
  .bpk-#{$prefix}-dynamic {
    // Base value: use the main CSS variable or fallback to 0
    #{$property}: var(--bpk-#{$prefix}, 0);

    // Responsive values: use breakpoint-specific CSS variables with fallback chain
    // The fallback chain ensures that if a breakpoint value is not set,
    // it falls back to the previous breakpoint or base value
    @include breakpoints.bpk-breakpoint-small-mobile {
      #{$property}: var(--bpk-#{$prefix}-smallMobile, var(--bpk-#{$prefix}, 0));
    }

    @include breakpoints.bpk-breakpoint-mobile {
      #{$property}: var(--bpk-#{$prefix}-mobile, var(--bpk-#{$prefix}-smallMobile, var(--bpk-#{$prefix}, 0)));
    }

    @include breakpoints.bpk-breakpoint-small-tablet {
      #{$property}: var(--bpk-#{$prefix}-smallTablet, var(--bpk-#{$prefix}-mobile, var(--bpk-#{$prefix}-smallMobile, var(--bpk-#{$prefix}, 0))));
    }

    @include breakpoints.bpk-breakpoint-tablet {
      #{$property}: var(--bpk-#{$prefix}-tablet, var(--bpk-#{$prefix}-smallTablet, var(--bpk-#{$prefix}-mobile, var(--bpk-#{$prefix}-smallMobile, var(--bpk-#{$prefix}, 0)))));
    }

    @include breakpoints.bpk-breakpoint-above-tablet {
      #{$property}: var(--bpk-#{$prefix}-desktop, var(--bpk-#{$prefix}-tablet, var(--bpk-#{$prefix}-smallTablet, var(--bpk-#{$prefix}-mobile, var(--bpk-#{$prefix}-smallMobile, var(--bpk-#{$prefix}, 0))))));
    }
  }
}

// Generate directional spacing utilities (top, right, bottom, left, x, y)
// This generates classes like bpk-padding-top-base, bpk-margin-right-sm, etc.
@mixin generate-directional-spacing-utilities($base-property, $prefix) {
  // Directional properties map: (direction-name, css-property)
  $directions: (
    'top': #{$base-property}-top,
    'right': #{$base-property}-right,
    'bottom': #{$base-property}-bottom,
    'left': #{$base-property}-left,
  );

  // Generate base utilities for each direction
  @each $direction, $css-property in $directions {
    @each $token, $value in $spacing-map {
      .bpk-#{$prefix}-#{$direction}-#{$token} {
        #{$css-property}: $value;
      }
    }
  }

  // Generate x-axis utilities (left + right)
  @each $token, $value in $spacing-map {
    .bpk-#{$prefix}-x-#{$token} {
      #{$base-property}-left: $value;
      #{$base-property}-right: $value;
    }
  }

  // Generate y-axis utilities (top + bottom)
  @each $token, $value in $spacing-map {
    .bpk-#{$prefix}-y-#{$token} {
      #{$base-property}-top: $value;
      #{$base-property}-bottom: $value;
    }
  }

  // Generate dynamic value classes for directional properties
  @each $direction, $css-property in $directions {
    .bpk-#{$prefix}-#{$direction}-dynamic {
      #{$css-property}: var(--bpk-#{$prefix}-#{$direction}, 0);
    }
  }

  .bpk-#{$prefix}-x-dynamic {
    #{$base-property}-left: var(--bpk-#{$prefix}-x, 0);
    #{$base-property}-right: var(--bpk-#{$prefix}-x, 0);
  }

  .bpk-#{$prefix}-y-dynamic {
    #{$base-property}-top: var(--bpk-#{$prefix}-y, 0);
    #{$base-property}-bottom: var(--bpk-#{$prefix}-y, 0);
  }
}

// Color map (Backpack color tokens to CSS custom properties)
$color-map: (
  // Text colors
  'textPrimary': tokens.$bpk-text-primary-day,
  'textSecondary': tokens.$bpk-text-secondary-day,
  'textDisabled': tokens.$bpk-text-disabled-day,
  'textOnDark': tokens.$bpk-text-on-dark-day,
  'textOnLight': tokens.$bpk-text-on-light-day,
  'textLink': tokens.$bpk-text-link-day,
  'textError': tokens.$bpk-text-error-day,
  'textSuccess': tokens.$bpk-text-success-day,
  'textHero': tokens.$bpk-text-hero-day,
  'textPrimaryInverse': tokens.$bpk-text-primary-inverse-day,
  'textDisabledOnDark': tokens.$bpk-text-disabled-on-dark-day,
  // Background colors
  'canvas': tokens.$bpk-canvas-day,
  'canvasContrast': tokens.$bpk-canvas-contrast-day,
  'surfaceDefault': tokens.$bpk-surface-default-day,
  'surfaceHighlight': tokens.$bpk-surface-highlight-day,
  'surfaceElevated': tokens.$bpk-surface-elevated-day,
  // Brand colors
  'corePrimary': tokens.$bpk-core-primary-day,
  'coreAccent': tokens.$bpk-core-accent-day,
  'corePrimaryDark': tokens.$bpk-core-primary-day,
  // Border colors
  'line': tokens.$bpk-line-day,
  'lineOnDark': tokens.$bpk-line-on-dark-day,
  // Status colors (using CSS variables directly)
  'statusSuccess': var(--bpk-status-success-day, rgb(0, 138, 0)),
  'statusSuccessFill': var(--bpk-status-success-fill-day, rgb(230, 255, 230)),
  'statusWarning': var(--bpk-status-warning-day, rgb(255, 187, 0)),
  'statusWarningFill': var(--bpk-status-warning-fill-day, rgb(255, 250, 230)),
  'statusError': var(--bpk-status-error-day, rgb(207, 47, 47)),
  'statusErrorFill': var(--bpk-status-error-fill-day, rgb(255, 230, 230))
);

// Generate color utility classes with bpk- prefix
@mixin generate-color-utilities($property, $prefix) {
  // Generate base utilities (no breakpoint)
  @each $token, $value in $color-map {
    .bpk-#{$prefix}-#{$token} {
      #{$property}: $value;
    }
  }

  // Generate responsive variants - classes are defined globally, media queries apply them
  @each $token, $value in $color-map {
    .bpk-#{$prefix}-#{$token}-smallMobile {
      @include breakpoints.bpk-breakpoint-small-mobile {
        #{$property}: $value;
      }
    }

    .bpk-#{$prefix}-#{$token}-mobile {
      @include breakpoints.bpk-breakpoint-mobile {
        #{$property}: $value;
      }
    }

    .bpk-#{$prefix}-#{$token}-smallTablet {
      @include breakpoints.bpk-breakpoint-small-tablet {
        #{$property}: $value;
      }
    }

    .bpk-#{$prefix}-#{$token}-tablet {
      @include breakpoints.bpk-breakpoint-tablet {
        #{$property}: $value;
      }
    }

    .bpk-#{$prefix}-#{$token}-desktop {
      @include breakpoints.bpk-breakpoint-above-tablet {
        #{$property}: $value;
      }
    }
  }
}

// Layout utility classes with bpk- prefix
@mixin generate-layout-utilities {
  // Display utilities
  .bpk-display-block {
    display: block;
  }

  .bpk-display-inline {
    display: inline;
  }

  .bpk-display-inlineBlock {
    display: inline-block;
  }

  .bpk-display-flex {
    display: flex;
  }

  .bpk-display-grid {
    display: grid;
  }

  .bpk-display-none {
    display: none;
  }

  // Flexbox utilities
  .bpk-flex-direction-row {
    flex-direction: row;
  }

  .bpk-flex-direction-column {
    flex-direction: column;
  }

  .bpk-flex-direction-rowReverse {
    flex-direction: row-reverse;
  }

  .bpk-flex-direction-columnReverse {
    flex-direction: column-reverse;
  }

  .bpk-flex-wrap-nowrap {
    flex-wrap: nowrap;
  }

  .bpk-flex-wrap-wrap {
    flex-wrap: wrap;
  }

  .bpk-flex-wrap-wrapReverse {
    flex-wrap: wrap-reverse;
  }

  .bpk-align-items-flexStart {
    align-items: flex-start;
  }

  .bpk-align-items-flexEnd {
    align-items: flex-end;
  }

  .bpk-align-items-center {
    align-items: center;
  }

  .bpk-align-items-baseline {
    align-items: baseline;
  }

  .bpk-align-items-stretch {
    align-items: stretch;
  }

  .bpk-justify-content-flexStart {
    justify-content: flex-start;
  }

  .bpk-justify-content-flexEnd {
    justify-content: flex-end;
  }

  .bpk-justify-content-center {
    justify-content: center;
  }

  .bpk-justify-content-spaceBetween {
    justify-content: space-between;
  }

  .bpk-justify-content-spaceAround {
    justify-content: space-around;
  }

  .bpk-justify-content-spaceEvenly {
    justify-content: space-evenly;
  }

  // Grid utilities
  .bpk-grid-template-columns-1fr {
    grid-template-columns: 1fr;
  }

  .bpk-grid-template-columns-repeat2 {
    grid-template-columns: repeat(2, 1fr);
  }

  .bpk-grid-template-columns-repeat3 {
    grid-template-columns: repeat(3, 1fr);
  }

  .bpk-grid-template-columns-repeat4 {
    grid-template-columns: repeat(4, 1fr);
  }

  // Overflow utilities
  .bpk-overflow-hidden {
    overflow: hidden;
  }

  .bpk-overflow-visible {
    overflow: visible;
  }

  .bpk-overflow-scroll {
    overflow: scroll;
  }

  .bpk-overflow-auto {
    overflow: auto;
  }

  // Overflow X utilities
  .bpk-overflow-x-hidden {
    overflow-x: hidden;
  }

  .bpk-overflow-x-visible {
    overflow-x: visible;
  }

  .bpk-overflow-x-scroll {
    overflow-x: scroll;
  }

  .bpk-overflow-x-auto {
    overflow-x: auto;
  }

  // Overflow Y utilities
  .bpk-overflow-y-hidden {
    overflow-y: hidden;
  }

  .bpk-overflow-y-visible {
    overflow-y: visible;
  }

  .bpk-overflow-y-scroll {
    overflow-y: scroll;
  }

  .bpk-overflow-y-auto {
    overflow-y: auto;
  }

  // Position utilities
  .bpk-position-static {
    position: static;
  }

  .bpk-position-relative {
    position: relative;
  }

  .bpk-position-absolute {
    position: absolute;
  }

  .bpk-position-fixed {
    position: fixed;
  }

  .bpk-position-sticky {
    position: sticky;
  }

  // Float utilities
  .bpk-float-left {
    float: left;
  }

  .bpk-float-right {
    float: right;
  }

  .bpk-float-none {
    float: none;
  }

  // Border radius utilities
  .bpk-border-radius-none {
    border-radius: 0;
  }

  .bpk-border-radius-sm {
    border-radius: tokens.$bpk-border-radius-sm;
  }

  .bpk-border-radius-md {
    border-radius: tokens.$bpk-border-radius-md;
  }

  .bpk-border-radius-lg {
    border-radius: tokens.$bpk-border-radius-lg;
  }

  .bpk-border-radius-xl {
    border-radius: tokens.$bpk-border-radius-xl;
  }

  .bpk-border-radius-full {
    border-radius: 50%;
  }

  // Border utilities
  .bpk-border-none {
    border: none;
  }

  .bpk-border-1 {
    border: tokens.$bpk-border-size-sm solid tokens.$bpk-line-day;
  }

  .bpk-border-2 {
    border: tokens.$bpk-border-size-sm solid tokens.$bpk-line-day;
  }

  // Dynamic border utilities using CSS variables (scheme 2)
  .bpk-border-radius-dynamic {
    border-radius: var(--bpk-border-radius, 0);
  }

  .bpk-border-dynamic {
    border: var(--bpk-border, none);
  }

  // Size properties (width, height, min-width, max-width, min-height, max-height)
  // Mobile-first approach: smallMobile is base (no media query), others use min-width
  .bpk-width-dynamic {
    // Base value (smallMobile): use the main CSS variable
    width: var(--bpk-width, initial);
    
    // mobile: applies from mobile breakpoint and above (overrides smallMobile)
    @include breakpoints.bpk-breakpoint-above-mobile {
      width: var(--bpk-width-mobile, var(--bpk-width, initial));
    }
    
    // desktop: applies from desktop breakpoint and above (overrides mobile)
    @include breakpoints.bpk-breakpoint-above-tablet {
      width: var(--bpk-width-desktop, var(--bpk-width-mobile, var(--bpk-width, initial)));
    }
  }

  .bpk-height-dynamic {
    height: var(--bpk-height, initial);
  }

  .bpk-min-width-dynamic {
    min-width: var(--bpk-min-width, initial);
  }

  .bpk-max-width-dynamic {
    max-width: var(--bpk-max-width, initial);
  }

  .bpk-min-height-dynamic {
    min-height: var(--bpk-min-height, initial);
  }

  .bpk-max-height-dynamic {
    max-height: var(--bpk-max-height, initial);
  }

  // Visibility and opacity
  .bpk-visibility-dynamic {
    visibility: var(--bpk-visibility, initial);
  }

  .bpk-opacity-dynamic {
    opacity: var(--bpk-opacity, initial);
  }

  // Position properties
  .bpk-position-dynamic {
    position: var(--bpk-position, initial);
  }

  .bpk-top-dynamic {
    top: var(--bpk-top, initial);
  }

  .bpk-right-dynamic {
    right: var(--bpk-right, initial);
  }

  .bpk-bottom-dynamic {
    bottom: var(--bpk-bottom, initial);
  }

  .bpk-left-dynamic {
    left: var(--bpk-left, initial);
  }

  .bpk-z-index-dynamic {
    z-index: var(--bpk-z-index, initial);
  }

  // Shadow properties
  .bpk-box-shadow-dynamic {
    box-shadow: var(--bpk-box-shadow, initial);
  }

  .bpk-text-shadow-dynamic {
    text-shadow: var(--bpk-text-shadow, initial);
  }

  // Typography properties
  .bpk-font-size-dynamic {
    font-size: var(--bpk-font-size, initial);
  }

  .bpk-font-weight-dynamic {
    font-weight: var(--bpk-font-weight, initial);
  }

  .bpk-line-height-dynamic {
    line-height: var(--bpk-line-height, initial);
  }

  .bpk-text-align-dynamic {
    text-align: var(--bpk-text-align, initial);
  }

  .bpk-text-transform-dynamic {
    text-transform: var(--bpk-text-transform, initial);
  }

  .bpk-text-decoration-dynamic {
    text-decoration: var(--bpk-text-decoration, initial);
  }

  .bpk-letter-spacing-dynamic {
    letter-spacing: var(--bpk-letter-spacing, initial);
  }

  // Cursor and pointer events
  .bpk-cursor-dynamic {
    cursor: var(--bpk-cursor, initial);
  }

  .bpk-pointer-events-dynamic {
    pointer-events: var(--bpk-pointer-events, initial);
  }

  // Transform properties
  .bpk-transform-dynamic {
    transform: var(--bpk-transform, initial);
  }

  .bpk-transform-origin-dynamic {
    transform-origin: var(--bpk-transform-origin, initial);
  }

  // Transition properties
  .bpk-transition-dynamic {
    transition: var(--bpk-transition, initial);
  }

  .bpk-transition-property-dynamic {
    transition-property: var(--bpk-transition-property, initial);
  }

  .bpk-transition-duration-dynamic {
    transition-duration: var(--bpk-transition-duration, initial);
  }

  .bpk-transition-timing-function-dynamic {
    transition-timing-function: var(--bpk-transition-timing-function, initial);
  }

  .bpk-transition-delay-dynamic {
    transition-delay: var(--bpk-transition-delay, initial);
  }

  // Grid properties
  // Mobile-first approach: smallMobile is base (no media query), others use min-width
  .bpk-grid-template-columns-dynamic {
    // Base value (smallMobile): use the main CSS variable
    grid-template-columns: var(--bpk-grid-template-columns, initial);
    
    // mobile: applies from mobile breakpoint and above (overrides smallMobile)
    @include breakpoints.bpk-breakpoint-above-mobile {
      grid-template-columns: var(--bpk-grid-template-columns-mobile, var(--bpk-grid-template-columns, initial));
    }
    
    // desktop: applies from desktop breakpoint and above (overrides mobile)
    @include breakpoints.bpk-breakpoint-above-tablet {
      grid-template-columns: var(--bpk-grid-template-columns-desktop, var(--bpk-grid-template-columns-mobile, var(--bpk-grid-template-columns, initial)));
    }
  }

  .bpk-grid-template-rows-dynamic {
    grid-template-rows: var(--bpk-grid-template-rows, initial);
  }

  .bpk-grid-template-areas-dynamic {
    grid-template-areas: var(--bpk-grid-template-areas, initial);
  }

  .bpk-grid-column-dynamic {
    grid-column: var(--bpk-grid-column, initial);
  }

  .bpk-grid-row-dynamic {
    grid-row: var(--bpk-grid-row, initial);
  }

  .bpk-grid-area-dynamic {
    grid-area: var(--bpk-grid-area, initial);
  }

  .bpk-grid-column-start-dynamic {
    grid-column-start: var(--bpk-grid-column-start, initial);
  }

  .bpk-grid-column-end-dynamic {
    grid-column-end: var(--bpk-grid-column-end, initial);
  }

  .bpk-grid-row-start-dynamic {
    grid-row-start: var(--bpk-grid-row-start, initial);
  }

  .bpk-grid-row-end-dynamic {
    grid-row-end: var(--bpk-grid-row-end, initial);
  }

  .bpk-grid-auto-flow-dynamic {
    grid-auto-flow: var(--bpk-grid-auto-flow, initial);
  }

  .bpk-grid-auto-rows-dynamic {
    grid-auto-rows: var(--bpk-grid-auto-rows, initial);
  }

  .bpk-grid-auto-columns-dynamic {
    grid-auto-columns: var(--bpk-grid-auto-columns, initial);
  }
}

// Responsive layout utilities with bpk- prefix
// Mobile-first approach: smallMobile is base (no media query), others use min-width
@mixin generate-responsive-layout-utilities {
  // Responsive display utilities
  // smallMobile: base value, applies to all sizes (no media query)
  .bpk-display-flex-smallMobile {
    display: flex;
  }

  .bpk-display-grid-smallMobile {
    display: grid;
  }

  .bpk-flex-direction-column-smallMobile {
    flex-direction: column;
  }

  .bpk-flex-direction-row-smallMobile {
    flex-direction: row;
  }

  // mobile: applies from mobile breakpoint and above (overrides smallMobile)
  .bpk-display-flex-mobile {
    @include breakpoints.bpk-breakpoint-above-mobile {
      display: flex;
    }
  }

  .bpk-display-grid-mobile {
    @include breakpoints.bpk-breakpoint-above-mobile {
      display: grid;
    }
  }

  .bpk-flex-direction-column-mobile {
    @include breakpoints.bpk-breakpoint-above-mobile {
      flex-direction: column;
    }
  }

  .bpk-flex-direction-row-mobile {
    @include breakpoints.bpk-breakpoint-above-mobile {
      flex-direction: row;
    }
  }

  // desktop: applies from desktop breakpoint and above (overrides mobile)
  .bpk-display-flex-desktop {
    @include breakpoints.bpk-breakpoint-above-tablet {
      display: flex;
    }
  }

  .bpk-display-grid-desktop {
    @include breakpoints.bpk-breakpoint-above-tablet {
      display: grid;
    }
  }

  .bpk-flex-direction-column-desktop {
    @include breakpoints.bpk-breakpoint-above-tablet {
      flex-direction: column;
    }
  }

  .bpk-flex-direction-row-desktop {
    @include breakpoints.bpk-breakpoint-above-tablet {
      flex-direction: row;
    }
  }
}

// Base component styles mixin
// Provides common base styles for all layout components
@mixin base-component-styles {
  box-sizing: border-box;
}

// Common utilities mixin
// Includes all commonly used utility classes (spacing, color, layout)
// This reduces repetition across component SCSS files
@mixin common-layout-utilities($include-gap: true, $include-border-color: false) {
  // Spacing utilities
  @include generate-spacing-utilities(padding, 'padding');
  @include generate-directional-spacing-utilities(padding, 'padding');
  @include generate-spacing-utilities(margin, 'margin');
  @include generate-directional-spacing-utilities(margin, 'margin');
  
  // Gap utilities (optional, not all components need gap)
  @if $include-gap {
    @include generate-spacing-utilities(gap, 'gap');
  }
  
  // Color utilities
  @include generate-color-utilities(background-color, 'bg');
  @include generate-color-utilities(color, 'color');
  
  // Border color utilities (optional, not all components need border-color)
  @if $include-border-color {
    @include generate-color-utilities(border-color, 'border-color');
  }
  
  // Layout utilities (border, border-radius, display, etc.)
  @include generate-layout-utilities;
}
