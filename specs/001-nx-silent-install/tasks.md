<!--
==============================================================================
DOCUMENT PURPOSE: Break down plan.md into executable STEPS (Task List)
==============================================================================

This task list provides specific, actionable steps for executing the NX silent
installation. Each task should be executable without re-reading spec or plan.

FOCUS: STEPS (What to do, in what order)
- Specific actions with file paths
- Commands to run
- Verification steps
- Execution order

‚úÖ INCLUDE in tasks.md:
- Granular tasks with exact file paths
- Commands to run (npm, git, etc.)
- Verification steps after each task
- Task dependencies and execution order
- Parallel execution markers [P]
- Checkpoints after each phase

‚ùå EXCLUDE from tasks.md (belongs in spec.md):
- Why tasks are needed (requirements rationale)
- User scenarios and acceptance criteria
- Success criteria and measurable outcomes

‚ùå EXCLUDE from tasks.md (belongs in plan.md):
- Implementation patterns and code examples
- Architecture decisions and trade-offs
- Configuration explanations

AUTOMATION:
- Auto-generated by `/speckit.tasks` from plan.md and spec.md
- Tasks derived from implementation patterns in plan
- Organized by user story priority from spec

VALIDATION:
- Each task should be executable independently (or with stated dependencies)
- File paths should be exact and absolute
- Commands should be copy-pasteable
- Verification criteria should be clear
==============================================================================
-->

# Tasks: NX Silent Installation

**Input**: Design documents from `/specs/001-nx-silent-install/`
**Prerequisites**: plan.md (required), spec.md (required for user stories), research.md

**Context**: This is an infrastructure installation, not a Backpack component. Tasks focus on installing NX 22.4.0 silently without activating any features.

**Tests**: No new automated tests required. Verification through existing test suites and manual checks.

**Organization**: Tasks are grouped by user story to enable independent implementation and verification.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2, US3, US4)
- Include exact file paths in descriptions

## Repository Paths

- **Root**: `/Users/abbyzhan/code/backpack/`
- **Package File**: `/Users/abbyzhan/code/backpack/package.json`
- **NX Config**: `/Users/abbyzhan/code/backpack/nx.json` (will be created)
- **Git Ignore**: `/Users/abbyzhan/code/backpack/.gitignore`

---

## Phase 1: Pre-Installation Baseline

**Purpose**: Capture current system state before making any changes to enable rollback if needed

- [X] T001 Create baseline directory `/Users/abbyzhan/code/backpack/.nx-baseline/` for storing pre-installation metrics
- [X] T002 [P] Backup `/Users/abbyzhan/code/backpack/package.json` to `/Users/abbyzhan/code/backpack/.nx-baseline/package.json.backup`
- [X] T003 [P] Backup `/Users/abbyzhan/code/backpack/.gitignore` to `/Users/abbyzhan/code/backpack/.nx-baseline/.gitignore.backup`
- [X] T004 [P] Run `npm test 2>&1 | tee /Users/abbyzhan/code/backpack/.nx-baseline/baseline-test.txt` to capture test output
- [X] T005 [P] Run `npm run lint 2>&1 | tee /Users/abbyzhan/code/backpack/.nx-baseline/baseline-lint.txt` to capture lint output
- [X] T006 [P] Run `npm run build 2>&1 | tee /Users/abbyzhan/code/backpack/.nx-baseline/baseline-build.txt` to capture build output
- [X] T007 Record test execution timing: `time npm test > /dev/null 2>&1` and document in `/Users/abbyzhan/code/backpack/.nx-baseline/baseline-timings.txt`
- [X] T008 Record lint execution timing: `time npm run lint > /dev/null 2>&1` and append to baseline-timings.txt
- [X] T009 Record build execution timing: `time npm run build > /dev/null 2>&1` and append to baseline-timings.txt
- [X] T010 Extract current package.json scripts section: `cat package.json | jq '.scripts' > /Users/abbyzhan/code/backpack/.nx-baseline/baseline-scripts.json`

**Checkpoint**: Baseline captured. If installation fails, use these files to verify rollback success.

---

## Phase 2: User Story 1 - Developer Runs Existing Scripts (Priority: P1) üéØ CORE

**Goal**: Install NX and verify all existing npm scripts continue working identically

**Independent Test**: Run npm test, npm run lint, npm run build, npm run storybook and compare output to baseline

### Installation (User Story 1)

- [X] T011 [US1] Install nx@22.4.0 as devDependency: `npm install nx@22.4.0 --save-dev --save-exact` in `/Users/abbyzhan/code/backpack/`
- [X] T012 [US1] Verify nx installed in devDependencies: `grep '"nx":' /Users/abbyzhan/code/backpack/package.json` (expected: `"nx": "22.4.0"`)
- [X] T013 [US1] Verify no scripts were modified: `diff <(cat /Users/abbyzhan/code/backpack/.nx-baseline/baseline-scripts.json) <(cat /Users/abbyzhan/code/backpack/package.json | jq '.scripts')` (expected: no differences)

### Configuration (User Story 1)

- [X] T014 [US1] Create `/Users/abbyzhan/code/backpack/nx.json` with minimal silent configuration:
```json
{
  "$schema": "./node_modules/nx/schemas/nx-schema.json",
  "extends": "nx/presets/npm.json",
  "affected": {
    "defaultBase": "main"
  },
  "tasksRunnerOptions": {
    "default": {
      "runner": "nx/tasks-runners/default",
      "options": {
        "cacheableOperations": []
      }
    }
  },
  "targetDefaults": {},
  "plugins": []
}
```
- [X] T015 [US1] Verify nx.json created: `[ -f /Users/abbyzhan/code/backpack/nx.json ] && echo "‚úì nx.json exists" || echo "‚úó ERROR: nx.json missing"`
- [X] T016 [US1] Verify plugins array is empty: `cat /Users/abbyzhan/code/backpack/nx.json | jq '.plugins'` (expected: `[]`)
- [X] T017 [US1] Verify cacheableOperations array is empty: `cat /Users/abbyzhan/code/backpack/nx.json | jq '.tasksRunnerOptions.default.options.cacheableOperations'` (expected: `[]`)
- [X] T018 [US1] Verify extends npm preset: `cat /Users/abbyzhan/code/backpack/nx.json | jq -r '.extends'` (expected: `"nx/presets/npm.json"`)
- [X] T019 [US1] Verify defaultBase is main: `cat /Users/abbyzhan/code/backpack/nx.json | jq -r '.affected.defaultBase'` (expected: `"main"`)

### Verification (User Story 1)

- [X] T020 [US1] Run npm test and verify identical behavior: `npm test 2>&1 | diff /Users/abbyzhan/code/backpack/.nx-baseline/baseline-test.txt -` (expect minimal/no differences)
- [X] T021 [US1] Run npm run lint and verify identical behavior: `npm run lint 2>&1 | diff /Users/abbyzhan/code/backpack/.nx-baseline/baseline-lint.txt -` (expect minimal/no differences)
- [X] T022 [US1] Run npm run build and verify identical behavior: `npm run build 2>&1 | diff /Users/abbyzhan/code/backpack/.nx-baseline/baseline-build.txt -` (expect minimal/no differences)
- [X] T023 [US1] Run npm run storybook briefly to verify startup: `timeout 10 npm run storybook 2>&1 | head -20` (verify no errors in first 20 lines)
- [X] T024 [US1] Verify test timing within ¬±5%: `time npm test > /dev/null 2>&1` (compare to baseline timing in baseline-timings.txt)
- [X] T025 [US1] Verify lint timing within ¬±5%: `time npm run lint > /dev/null 2>&1` (compare to baseline timing)
- [X] T026 [US1] Verify build timing within ¬±5%: `time npm run build > /dev/null 2>&1` (compare to baseline timing)
- [X] T027 [US1] Verify no new npm warnings: Check test/lint/build output for any warnings mentioning "nx" or "workspace"

**Checkpoint**: User Story 1 complete. All existing scripts work identically to pre-installation.

---

## Phase 3: User Story 2 - Version Verification (Priority: P2)

**Goal**: Verify NX installation version is correct and accessible

**Independent Test**: Run `npx nx --version` and verify output is "22.4.0"

- [X] T028 [US2] Verify NX version via npx: `npx nx --version` (expected output: `22.4.0`)
- [X] T029 [US2] Verify NX executable exists in node_modules: `[ -f /Users/abbyzhan/code/backpack/node_modules/.bin/nx ] && echo "‚úì NX executable exists" || echo "‚úó ERROR: NX executable missing"`
- [X] T030 [US2] Verify NX package version in node_modules: `cat /Users/abbyzhan/code/backpack/node_modules/nx/package.json | jq -r '.version'` (expected: `22.4.0`)
- [X] T031 [US2] Document NX installation for team: Create `/Users/abbyzhan/code/backpack/.nx-baseline/installation-verified.txt` with version info and timestamp

**Checkpoint**: User Story 2 complete. NX version verified and documented.

---

## Phase 4: User Story 3 - Git Ignores NX Cache (Priority: P2)

**Goal**: Configure git to ignore NX cache directories

**Independent Test**: Create .nx/cache and .nx/workspace-data directories, verify they don't appear in git status

- [X] T032 [US3] Add NX cache entries to `/Users/abbyzhan/code/backpack/.gitignore`:
```gitignore
# NX cache directories (added 2026-01-27)
.nx/cache
.nx/workspace-data
```
- [X] T033 [US3] Verify .gitignore entries added: `grep -E '\.nx/(cache|workspace-data)' /Users/abbyzhan/code/backpack/.gitignore | wc -l` (expected: 2)
- [X] T034 [US3] Create test cache directories: `mkdir -p /Users/abbyzhan/code/backpack/.nx/cache /Users/abbyzhan/code/backpack/.nx/workspace-data`
- [X] T035 [US3] Create test files in cache directories: `touch /Users/abbyzhan/code/backpack/.nx/cache/test.txt /Users/abbyzhan/code/backpack/.nx/workspace-data/test.txt`
- [X] T036 [US3] Verify git ignores .nx/cache: `git status --porcelain | grep '.nx/cache'` (expected: no output)
- [X] T037 [US3] Verify git ignores .nx/workspace-data: `git status --porcelain | grep '.nx/workspace-data'` (expected: no output)
- [X] T038 [US3] Clean up test cache directories: `rm -rf /Users/abbyzhan/code/backpack/.nx/`

**Checkpoint**: User Story 3 complete. Git correctly ignores NX cache directories.

---

## Phase 5: User Story 4 - CI Pipeline Passes (Priority: P1) üéØ CRITICAL

**Goal**: Verify installation doesn't break CI pipeline

**Independent Test**: Push changes to remote branch and monitor CI execution

- [ ] T039 [US4] Stage changes for commit: `git add /Users/abbyzhan/code/backpack/package.json /Users/abbyzhan/code/backpack/nx.json /Users/abbyzhan/code/backpack/.gitignore`
- [ ] T040 [US4] Verify only expected files staged: `git status --short` (expected: M package.json, A nx.json, M .gitignore, no other files)
- [ ] T041 [US4] Verify package-lock.json is staged if it exists: `git diff --cached --name-only | grep -E 'package-lock.json|package.json'`
- [ ] T042 [US4] Create commit with NX installation: `git commit -m "$(cat <<'EOF'
Install NX 22.4.0 in silent mode

- Add nx@22.4.0 as devDependency (exact version)
- Create nx.json with minimal npm preset configuration
- Configure empty plugins and cacheableOperations arrays
- Add .nx/cache and .nx/workspace-data to .gitignore
- No changes to existing scripts or functionality
- All existing npm scripts work identically
- Zero impact on current workflows

Ref: specs/001-nx-silent-install/spec.md

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
EOF
)"`
- [ ] T043 [US4] Push branch to remote: `git push -u origin 001-nx-silent-install`
- [ ] T044 [US4] Monitor CI pipeline execution: Open GitHub Actions and watch for pipeline completion
- [ ] T045 [US4] Verify all CI checks pass: Check CI status (tests, lint, build all pass)
- [ ] T046 [US4] Verify CI timing acceptable: Compare CI execution time to typical baseline (should be within ¬±10%)
- [ ] T047 [US4] Verify no new CI warnings or errors: Review CI logs for any mentions of "nx" or "workspace" warnings

**Checkpoint**: User Story 4 complete. CI pipeline passes with NX installed.

---

## Phase 6: Final Verification & Documentation

**Purpose**: Complete final verification and documentation for release

- [ ] T048 [P] Run full verification suite: `npm test && npm run lint && npm run build` (all must pass)
- [ ] T049 [P] Verify all functional requirements from spec.md:
  - FR-001: nx@22.4.0 in devDependencies ‚úì
  - FR-002: nx.json exists ‚úì
  - FR-003: extends npm preset ‚úì
  - FR-004: plugins: [] ‚úì
  - FR-005: cacheableOperations: [] ‚úì
  - FR-006: defaultBase: "main" ‚úì
  - FR-007: .nx/cache in .gitignore ‚úì
  - FR-008: .nx/workspace-data in .gitignore ‚úì
  - FR-009: scripts unchanged ‚úì
  - FR-010: dependencies unchanged (only nx added) ‚úì
  - FR-011: no features activated ‚úì
  - FR-012: npx nx --version returns 22.4.0 ‚úì
- [ ] T050 [P] Verify all success criteria from spec.md:
  - SC-001: npx nx --version = "22.4.0" ‚úì
  - SC-002: nx in devDependencies ‚úì
  - SC-003: nx.json exists with plugins: [] ‚úì
  - SC-004: .gitignore contains .nx entries ‚úì
  - SC-005: npm test works identically ‚úì
  - SC-006: npm run lint works identically ‚úì
  - SC-007: npm run build works identically ‚úì
  - SC-008: npm run storybook works identically ‚úì
  - SC-009: CI passes ‚úì
  - SC-010: scripts unchanged ‚úì
  - SC-011: .nx not in git status ‚úì
- [ ] T051 Create summary report in `/Users/abbyzhan/code/backpack/.nx-baseline/installation-report.md` documenting:
  - Installation date and time
  - NX version installed
  - Files modified (package.json, nx.json, .gitignore)
  - Verification results (all tests pass)
  - Timing comparisons (before/after)
  - CI pipeline status
  - Any observations or notes
- [ ] T052 Clean up baseline directory: Archive `/Users/abbyzhan/code/backpack/.nx-baseline/` for future reference
- [ ] T053 Create pull request with title: "Install NX 22.4.0 in silent mode"
- [ ] T054 Add PR description summarizing:
  - What was installed (NX 22.4.0)
  - Configuration approach (silent mode, npm preset)
  - Verification results (all tests pass, zero impact)
  - Link to spec.md, plan.md, tasks.md
- [ ] T055 Request code review from team
- [ ] T056 After approval, merge PR to main branch
- [ ] T057 Monitor main branch CI after merge
- [ ] T058 Notify #backpack Slack channel about NX installation with zero-impact message
- [ ] T059 Document future activation roadmap in team wiki or documentation

**Checkpoint**: Installation complete, verified, documented, and merged.

---

## Dependencies & Execution Order

### Phase Dependencies

- **Phase 1 (Pre-Installation Baseline)**: No dependencies - must complete FIRST
- **Phase 2 (User Story 1)**: Depends on Phase 1 completion
- **Phase 3 (User Story 2)**: Depends on Phase 2 completion (needs NX installed)
- **Phase 4 (User Story 3)**: Can run after Phase 2 (independent of US2)
- **Phase 5 (User Story 4)**: Depends on Phases 2, 3, 4 completion (needs all changes committed)
- **Phase 6 (Final Verification)**: Depends on all previous phases

### User Story Dependencies

- **User Story 1 (P1)**: CORE - Must complete before any other user stories
- **User Story 2 (P2)**: Depends on US1 (needs NX installed)
- **User Story 3 (P2)**: Can run in parallel with US2 after US1 completes
- **User Story 4 (P1)**: CRITICAL - Depends on US1, US2, US3 (needs all changes ready for commit)

### Within Each Phase

- Tasks within Pre-Installation Baseline can mostly run in parallel (marked [P])
- US1 tasks must run sequentially (installation ‚Üí configuration ‚Üí verification)
- US2, US3 tasks can run in parallel after US1 completes
- US4 tasks must run sequentially (stage ‚Üí commit ‚Üí push ‚Üí monitor)
- Final verification tasks can run in parallel (marked [P])

### Parallel Opportunities

After US1 completes:
- **Parallel Track A**: US2 (Version Verification) - T028-T031
- **Parallel Track B**: US3 (Git Ignore Configuration) - T032-T038
- Both tracks independent and can proceed simultaneously

---

## Implementation Strategy

### Recommended Execution Flow

**Step 1: Baseline (30 minutes)**
1. Complete Phase 1 (T001-T010) - Capture current state
2. **VALIDATE**: Confirm baseline files created successfully

**Step 2: Core Installation (45 minutes)**
3. Complete Phase 2 (T011-T027) - Install NX and verify scripts work
4. **VALIDATE**: All tests pass, scripts work identically, timing acceptable

**Step 3: Parallel Verification (30 minutes)**
5. Complete Phase 3 (T028-T031) - Verify version
6. Complete Phase 4 (T032-T038) - Configure git ignore
7. **VALIDATE**: Version correct, git ignoring cache directories

**Step 4: CI Validation (60 minutes)**
8. Complete Phase 5 (T039-T047) - Commit, push, verify CI
9. **VALIDATE**: CI passes, no new warnings

**Step 5: Final Review (30 minutes)**
10. Complete Phase 6 (T048-T059) - Final verification and PR
11. **VALIDATE**: All requirements met, PR approved

**Total Estimated Time**: 3 hours (plus CI wait time and PR review time)

### MVP Scope (User Story 1 Only)

**Minimal Viable Installation**:
- Phase 1: Pre-Installation Baseline
- Phase 2: User Story 1 (Installation + Verification)
- Verification: npm test/lint/build all work identically

At this point, you have a working NX installation that can be validated locally before proceeding to CI.

### Incremental Validation

- After Phase 2: Test locally ‚Üí If any issues, rollback immediately
- After Phase 3-4: Test git behavior ‚Üí Verify cache ignored
- After Phase 5: Test CI ‚Üí If CI fails, investigate before merge
- Each phase validates independently before proceeding

### Rollback Procedure (If Needed)

If any phase fails:

```bash
# 1. Remove nx from package.json
npm uninstall nx

# 2. Delete nx.json
rm /Users/abbyzhan/code/backpack/nx.json

# 3. Restore .gitignore
cp /Users/abbyzhan/code/backpack/.nx-baseline/.gitignore.backup /Users/abbyzhan/code/backpack/.gitignore

# 4. Reinstall dependencies
npm install

# 5. Verify rollback
npm test && echo "‚úì Rollback successful"
git restore --staged .
```

Then investigate the failure before reattempting.

---

## Success Indicators

**Installation is successful if**:
- ‚úÖ All baseline comparisons show identical behavior
- ‚úÖ npx nx --version returns "22.4.0"
- ‚úÖ All existing npm scripts work without changes
- ‚úÖ No new warnings or errors in any script output
- ‚úÖ Script timing within ¬±5% of baseline
- ‚úÖ Git ignores .nx directories
- ‚úÖ CI pipeline passes without modifications
- ‚úÖ All 12 functional requirements met
- ‚úÖ All 11 success criteria met

**Should rollback if**:
- ‚ùå Any npm script behavior changes
- ‚ùå Any npm script timing increases >10%
- ‚ùå New warnings or errors appear
- ‚ùå CI pipeline fails
- ‚ùå Scripts section was modified
- ‚ùå Other dependencies changed

---

## Notes

- All paths are absolute to avoid ambiguity
- Baseline directory (.nx-baseline/) is not committed to git
- Timing comparisons have ¬±5% tolerance for normal variation
- CI validation is critical - don't merge if CI fails
- Keep team informed throughout process
- Document any unexpected behavior in installation-report.md
- This is Phase 1 of gradual NX adoption - features will be activated in future PRs

## References

- **Specification**: `/Users/abbyzhan/code/backpack/specs/001-nx-silent-install/spec.md`
- **Implementation Plan**: `/Users/abbyzhan/code/backpack/specs/001-nx-silent-install/plan.md`
- **Research**: `/Users/abbyzhan/code/backpack/specs/001-nx-silent-install/research.md`
- **Requirements Checklist**: `/Users/abbyzhan/code/backpack/specs/001-nx-silent-install/checklists/requirements.md`
- **NX Documentation**: https://nx.dev/getting-started/intro
- **NX npm Preset**: https://nx.dev/recipes/adopting-nx/adding-to-monorepo
