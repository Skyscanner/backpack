<!--
==============================================================================
DOCUMENT PURPOSE: Design HOW to implement spec.md requirements (Implementation)
==============================================================================

This plan describes the technical solution for developers implementing the
component. It bridges the gap between "what we need" (spec) and "what we do" (tasks).

FOCUS: HOW
- How to implement the requirements
- What technologies and patterns to use
- How files should be organized

✅ INCLUDE in plan.md:
- Technical approach and architecture decisions
- Complete TypeScript interface definitions with code
- React component patterns and examples
- Sass/CSS implementation patterns with code
- File structure and organization details
- Import strategies and module dependencies
- Migration strategies for existing code
- Code examples showing HOW to implement each requirement

❌ EXCLUDE from plan.md (belongs in spec.md):
- Requirements explanations and rationale
- User scenarios and acceptance criteria
- Success criteria and measurable outcomes
- Why features are needed (business justification)

❌ EXCLUDE from plan.md (belongs in tasks.md):
- Granular task lists with file paths
- Specific commands to run
- Task execution order and dependencies
- Step-by-step instructions

AUTOMATION:
- Auto-generated by `/speckit.plan` from spec.md requirements
- Derives implementation patterns from spec constraints
- Feeds into `/speckit.tasks` for task generation

VALIDATION:
- Every spec requirement should have implementation guidance
- Code examples should be complete and executable
- Patterns should follow Backpack constitution principles
==============================================================================
-->

# Implementation Plan: BpkCheckboxCard

**Package Branch**: `002-checkbox-card` | **Date**: 2026-02-06 | **Spec**: [specs/002-checkbox-card/spec.md](./spec.md)
**Input**: BpkCheckboxCard - Composable checkbox card component with flexible content composition, 3 visual variants, multiple states, BpkText-based Label/Description subcomponents

## Summary

BpkCheckboxCard is a composable checkbox card component that combines checkbox functionality with card-based UI patterns. Built on Ark UI checkbox logic, it provides a flexible subcomponent architecture (Root, Control, Content, Label, Description, Indicator, Addon, HiddenInput) allowing developers to customize content layout. Features include three visual variants (default, contrast, surface-contrast), configurable border radius (square/rounded), indicator placement control (start/end), and full state management (checked, disabled, invalid, readonly). Label and Description subcomponents are built on BpkText with dynamic text color changes (text-primary-day → text-on-dark-day when checked) for proper contrast on colored backgrounds.

## Technical Context

**Framework**: React 18.3.1 with TypeScript 5.9.2
**Styling**: CSS Modules + Sass (modern API with `@use`)
**Testing**: Jest 30 + Testing Library + jest-axe
**Build Tools**: Webpack 5, Babel 7
**Linting**: ESLint (@skyscanner/eslint-config-skyscanner), Stylelint
**Component Library**: Backpack Design System (Monorepo)
**Package Manager**: npm >=10.7.0
**Node Version**: >=18.20.4
**Target Browsers**: Chrome 109+, Edge 129+, Firefox 131+, Safari 15+, Samsung 26+
**Performance Goals**: Meet test coverage thresholds (70% branches, 75% functions/lines/statements)
**Constraints**: Must follow Backpack constitution and architecture decisions
**Scale/Scope**: Single reusable component in `packages/bpk-component-[name]/`

## Performance Constraints

### Bundle Size Impact
- **Component code**: < 8KB minified (component + styles combined)
- **Peer dependency (Ark UI)**: Already included by consumer, no additional impact
- **Target**: Minimal impact to overall Backpack bundle size
- **Verification**: Measure in Phase 10 using `npm run build` and analyze bundle metrics

### Render Performance
- **No unnecessary re-renders**: Context updates only affect subscribers
- **Subcomponent optimization**: Consider React.memo for non-interactive subcomponents (Indicator, Addon)
- **Avoid**: Inline function definitions in render path; memoize callbacks
- **Verification**: Test with React DevTools Profiler in Phase 10

### Accessibility Overhead
- **jest-axe test completion**: < 1 second per test file
- **Focus ring calculation**: CSS-based (no JavaScript animation)
- **No performance regression**: Component performance comparable to similar Backpack components
- **Verification**: Include performance benchmarks in Phase 10 testing report

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Compliance

- [x] **Component-First Architecture**: Package in `packages/bpk-component-checkbox-card/`
- [x] **Naming Conventions**: BpkCheckboxCard (PascalCase), BpkCheckboxCard.module.scss, *-test.tsx
- [x] **License Headers**: All source files include Apache 2.0 license header
- [x] **Modern Sass**: Using `@use` syntax with granular imports from `bpk-mixins`
- [x] **Accessibility-First**: Includes `accessibility-test.tsx` with jest-axe
- [x] **TypeScript**: All code in TypeScript with full type safety
- [x] **SemVer**: MINOR version bump (new component feature)
- [x] **Deprecation Management**: N/A (new component, no deprecations)
- [x] **Test Coverage**: Target 70% branches, 75% functions/lines/statements
- [x] **Documentation**: README.md, Storybook stories, JSDoc, Figma Code Connect

### Technology Compliance

- [x] **React Version**: Using React 18.3.1
- [x] **TypeScript Version**: Using TypeScript 5.9.2
- [x] **CSS Modules**: All styles use `.module.scss` extension
- [x] **rem Units**: All sizing values use `rem` (not `px` or `em`)
- [x] **Design Tokens**: Uses tokens from `@skyscanner/bpk-foundations-web` and `bpk-mixins`
- [x] **BEM Naming**: CSS classes follow BEM with `bpk-` prefix
- [x] **RTL Support**: Component supports right-to-left languages (flex-direction, indicatorPlacement)
- [x] **Browser Support**: Works on all supported browsers (Chrome 109+, Edge 129+, Firefox 131+, Safari 15+)

### Testing Compliance

- [x] **Unit Tests**: Jest + Testing Library tests in `BpkCheckboxCard-test.tsx`
- [x] **Accessibility Tests**: jest-axe tests in `accessibility-test.tsx`
- [x] **Visual Tests**: Percy tests via Storybook (no images used)
- [x] **Snapshot Tests**: Included for all variants, radius, states
- [x] **Coverage Thresholds**: Target 70% branches, 75% functions/lines/statements

### Documentation Compliance

- [x] **British English**: Prose uses British English, code uses US English
- [x] **Sentence Case**: Titles use sentence case, singular form
- [x] **<100 Words**: Component description under 100 words
- [x] **Storybook**: Stories in `examples/bpk-component-checkbox-card/stories.tsx`
- [x] **JSDoc**: All public APIs documented
- [x] **Figma Connect**: `.figma.tsx` file connects to Figma designs

## Type Definitions

### Component Props Interface

```typescript
interface BpkCheckboxCardProps {
  // State management
  checked?: boolean;
  defaultChecked?: boolean;
  onCheckedChange?: (checked: boolean) => void;

  // State modifiers
  disabled?: boolean;
  readonly?: boolean;
  invalid?: boolean;

  // Styling
  variant?: 'default' | 'contrast' | 'surface-contrast';
  radius?: 'square' | 'rounded';
  indicatorPlacement?: 'start' | 'end';

  // Sizing
  maxW?: string;
  maxH?: string;

  // Form integration
  name?: string;
  value?: string;
  form?: string;
  required?: boolean;
  id?: string;

  // DOM
  className?: string;
  children?: React.ReactNode;
}
```

### Context Value Interface

```typescript
interface BpkCheckboxCardContextValue {
  checked: boolean;
  disabled: boolean;
  readonly: boolean;
  variant: 'default' | 'contrast' | 'surface-contrast';
  radius: 'square' | 'rounded';
  indicatorPlacement: 'start' | 'end';
}
```

### Subcomponent Props

All subcomponents extend React.HTMLAttributes and support `asChild` prop for composition flexibility:

```typescript
interface BpkCheckboxCardRootProps extends BpkCheckboxCardProps {}

interface BpkCheckboxCardControlProps extends React.HTMLAttributes<HTMLDivElement> {
  asChild?: boolean;
}

interface BpkCheckboxCardContentProps extends React.HTMLAttributes<HTMLDivElement> {
  asChild?: boolean;
}

interface BpkCheckboxCardLabelProps extends React.HTMLAttributes<HTMLLabelElement> {
  asChild?: boolean;
  children?: React.ReactNode;
}

interface BpkCheckboxCardDescriptionProps extends React.HTMLAttributes<HTMLDivElement> {
  asChild?: boolean;
  children?: React.ReactNode;
}

interface BpkCheckboxCardIndicatorProps extends React.HTMLAttributes<HTMLDivElement> {
  asChild?: boolean;
}

interface BpkCheckboxCardAddonProps extends React.HTMLAttributes<HTMLDivElement> {
  asChild?: boolean;
  children?: React.ReactNode;
}

interface BpkCheckboxCardHiddenInputProps extends React.InputHTMLAttributes<HTMLInputElement> {}
```

## Implementation Approach by Functional Requirement

## Ark UI Integration Pattern

The component architecture wraps Ark UI's Checkbox.Root with CheckboxCardContext for composable subcomponents:

```
Root Component
  ├── Wraps: Ark UI Checkbox.Root
  ├── Provides: CheckboxCardContext (state, styling)
  │
  └── Children
      ├── HiddenInput → Ark UI Checkbox.HiddenInput (native checkbox)
      ├── Control (layout container)
      │   ├── Indicator (replaces Ark UI default visual)
      │   └── Content
      │       ├── Label (BpkText wrapper)
      │       └── Description (BpkText wrapper)
      └── Addon (outside control area)
```

**Key Separation of Concerns**:
- **Ark UI manages**: Checkbox state, ARIA attributes, keyboard events, form integration
- **BpkCheckboxCard manages**: Visual styling, color tokens, typography, composition
- **Context provides**: Checked state, disabled/readonly flags, variant/radius, color calculations

**No conflicts**:
- Ark UI props (checked, defaultChecked, onCheckedChange) map through Root directly
- Context state mirrors Ark UI state (one-way binding)
- Subcomponents consume context, do NOT duplicate prop drilling
- HiddenInput is NOT styled (Ark UI handles input element)

**FR-001**: Composable Subcomponents Architecture
- **Approach**: Compound component pattern with context provider + Ark UI integration
- **Implementation**: Root wraps Ark UI + provides CheckboxCardContext, subcomponents (Control, Content, Label, Description, Indicator, Addon, HiddenInput) consume context
- **Pattern**: Render props + React Context for flexible composition with Ark UI primitives

**FR-002**: Three Visual Variants (default, contrast, surface-contrast)
- **Approach**: Variant prop on Root maps to CSS class modifier
- **Implementation**: CSS classes `.bpk-checkbox-card--variant-default`, `.bpk-checkbox-card--variant-contrast`, `.bpk-checkbox-card--variant-surface-contrast`
- **Pattern**: Variant-specific styling with design token colors

**FR-003**: Border Radius Options (square, rounded)
- **Approach**: Radius prop on Root maps to CSS class modifier
- **Implementation**: CSS classes `.bpk-checkbox-card--radius-square` (border-radius: 0), `.bpk-checkbox-card--radius-rounded` (border-radius: tokens.bpk-border-radius-md)
- **Pattern**: Conditional border-radius via CSS modifier classes

**FR-004**: Indicator Placement (start, end)
- **Approach**: indicatorPlacement prop on Root determines flex order
- **Implementation**: flex-direction via CSS or component render order
- **Pattern**: RTL-aware placement using CSS logical properties

**FR-005**: All Checkbox States (checked, unchecked, disabled, invalid, readonly)
- **Approach**: Ark UI manages state, Backpack applies CSS modifiers
- **Implementation**: `.bpk-checkbox-card--checked`, `.bpk-checkbox-card--disabled`, `aria-invalid` for invalid
- **Pattern**: CSS classes for visual states, ARIA attributes for semantic states

**FR-006**: BpkText-based Label & Description with Dynamic Colors
- **Approach**: Wrap BpkText components with default props and color management
- **Implementation**: Label exports bpk-heading-5 + text-primary-day (default) / text-on-dark-day (checked)
- **Implementation**: Description exports bpk-footnote + text-secondary-day (default) / text-on-dark-day (checked)
- **Pattern**: Context-driven color calculation based on checked state

### Dynamic Color Behavior Rules

**Label & Description (BpkText-based)**
- **Default state**:
  - Label: `text-primary-day`
  - Description: `text-secondary-day`
- **Checked state**: Both change to `text-on-dark-day` (for contrast on checked backgrounds)
- **Disabled state**: Both change to `text-disabled-day`
- **Scope**: Applies ONLY to direct Label/Description subcomponents
- **Implementation**: Color prop passed to BpkText via context state

**Custom Content (via asChild or children)**
- **Color handling**: NO automatic color changes applied
- **Responsibility**: Consumer is responsible for color application via props
- **Rationale**: Supports arbitrary content (icons, badges, custom layout) with consumer control
- **Test case**: Verify custom content renders with consumer's provided colors

**Addon Component**
- **Default state**: `text-secondary-day` (supporting element)
- **Checked state**: `text-secondary-day` (no change)
- **Rationale**: Supporting element, not primary content, stays visually secondary
- **Scope**: Only the Addon subcomponent, not children within it

**FR-007**: Addon Content Outside Control Area
- **Approach**: Addon subcomponent renders as sibling to Control
- **Implementation**: Flex layout with Content and Addon as separate flex items
- **Pattern**: Layout managed by Root layout

**FR-008**: Label-Checkbox Association for Accessibility
- **Approach**: Ark UI handles association via HiddenInput
- **Implementation**: Label htmlFor attribute connects to HiddenInput id
- **Pattern**: Semantic HTML form elements

**FR-009**: onChange Event Callbacks
- **Approach**: onCheckedChange prop on Root (from Ark UI)
- **Implementation**: Passed directly to Ark UI Checkbox.Root
- **Pattern**: Event delegation through context

**FR-010**: Controlled & Uncontrolled Patterns
- **Approach**: Ark UI supports both via checked/defaultChecked props
- **Implementation**: Pass checked prop for controlled, defaultChecked for uncontrolled
- **Pattern**: React form patterns

**FR-011**: Form Submission Support
- **Approach**: HiddenInput provides native form integration
- **Implementation**: name and value props on HiddenInput
- **Pattern**: Standard HTML form submission

**FR-012**: All Visual States (default, hover, selected, disabled)
- **Approach**: CSS pseudo-classes and modifier classes
- **Implementation**: `:hover`, `:checked` pseudo-classes, `.bpk-checkbox-card--checked` class
- **Pattern**: CSS-driven state styling

**FR-013**: maxW & maxH Props for Sizing
- **Approach**: Inline styles on Root element
- **Implementation**: style prop passes {maxWidth, maxHeight} to wrapper div
- **Pattern**: Dynamic styling via inline styles

## Project Structure

### Documentation (this component)

```text
specs/[###-component-name]/
├── spec.md              # Component specification
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── api-design.md        # Phase 1 output (/speckit.plan command)
├── styling-guide.md     # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

**Note**: Storybook examples are created in `examples/bpk-component-[name]/` directory (separate from specs), not within the specs directory.

### Package Structure (Backpack Monorepo)

```text
packages/bpk-component-[name]/
├── README.md                     # Component documentation (British English prose)
├── index.ts                      # Export entry point (exports from src/)
├── docs/                         # Documentation assets
│   ├── screenshots/              # Component screenshots for README
│   └── design-assets/            # Figma exports, design references
└── src/
    ├── Bpk[ComponentName]/       # Component directory (e.g., BpkButton/)
    │   ├── Bpk[ComponentName].tsx            # Main component implementation
    │   ├── Bpk[ComponentName].module.scss    # CSS Modules styles
    │   ├── Bpk[ComponentName]-test.tsx       # Unit tests (Jest + Testing Library)
    │   ├── accessibility-test.tsx            # Accessibility tests (jest-axe)
    │   ├── Bpk[ComponentName].figma.tsx      # Figma Code Connect
    │   ├── common-types.ts                   # Shared TypeScript types
    │   └── __snapshots__/                    # Jest snapshot files
    │       └── Bpk[ComponentName]-test.tsx.snap
    └── themeAttributes.ts        # Theme attributes (if themeable)
```

### Storybook Examples

```text
examples/bpk-component-[name]/
├── stories.tsx                    # Storybook story definitions (CSF 3.0)
├── examples.tsx                   # Example component implementations
├── [ComponentName]Story.module.scss # Styles for examples (if needed)
└── README.md                      # Example documentation (optional)
```

**Structure Decision**: Backpack uses a Monorepo architecture where each component is a separate package in `packages/`. This enables:
- Independent versioning per component
- Clear dependency boundaries
- Isolated testing and documentation
- Easier maintenance and updates

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., Using external dependency X] | [specific problem it solves] | [why Backpack's built-in solution insufficient] |
| [e.g., Not using CSS Modules] | [technical constraint] | [why standard approach won't work] |

If no violations: **No constitution violations. Component follows all Backpack standards.**

## Phase 0: Research & Discovery

**Objective**: Understand existing patterns and gather context

### Research Tasks

1. **Survey Existing Components**:
   - Review similar components in `packages/` (e.g., buttons, cards, inputs)
   - Identify reusable patterns and common approaches
   - Check for existing utilities in `bpk-react-utils`
   - Review design tokens in `@skyscanner/bpk-foundations-web`

2. **Review Sass Mixins**:
   - Explore `packages/bpk-mixins/` for relevant utilities
   - Identify which mixins to import (tokens, typography, shadows, etc.)
   - Check modern Sass API usage examples

3. **Study Testing Patterns**:
   - Review test files in similar components
   - Understand jest-axe usage patterns
   - Check Storybook story structures in `examples/`

4. **Figma Design Review**:
   - Review Figma designs and specifications
   - Identify all visual states (default, hover, focus, active, disabled)
   - Note responsive behavior and breakpoints
   - Document design token mappings

5. **Architecture Decisions Review**:
   - Read relevant files in `decisions/` directory
   - Understand naming conventions (js-filenames.md, component-scss-filenames.md)
   - Review modern Sass API requirements (modern-sass-api.md)
   - Check versioning rules (versioning-rules.md)
   - Understand deprecation policies (deprecated-api.md, future-api.md)

**Deliverable**: `research.md` documenting findings and patterns to follow

## Phase 1: Design & Planning

**Objective**: Design component API and structure before implementation

### API Design

**Deliverable**: `api-design.md` containing:

1. **Component Props Interface**:
```typescript
type Bpk[ComponentName]Props = {
  // Define all props with types, defaults, and documentation
  variant: 'primary' | 'secondary' | 'tertiary';
  size?: 'small' | 'medium' | 'large'; // default: 'medium'
  disabled?: boolean; // default: false
  className?: string;
  children?: ReactNode;
  onClick?: (event: MouseEvent<HTMLElement>) => void;
  ariaLabel?: string;
  // ... other props
};
```

2. **Component Composition**:
   - If component is composed of sub-components, define their interfaces
   - Document how they work together
   - Example: `BpkAccordion` + `BpkAccordionItem`

3. **Theming Support**:
   - If component is themeable, define theme attributes in `themeAttributes.ts`
   - Document which properties can be themed
   - Example theme attributes for customization

4. **Accessibility Considerations**:
   - ARIA attributes required
   - Keyboard navigation support (Tab, Enter, Space, etc.)
   - Screen reader announcements
   - Focus management

### Themeable Properties

The following tokens should support runtime customization via CSS variables for theme switching:

### Themeable Token Mapping

| Token | CSS Variable | Property | Use Case |
|-------|--------------|----------|----------|
| `$bpk-surface-default-day` | `--bpk-checkbox-card-default-bg` | background-color | Default variant background |
| `$bpk-surface-contrast-day` | `--bpk-checkbox-card-contrast-bg` | background-color | Contrast variant background |
| `$bpk-core-accent-day` | `--bpk-checkbox-card-checked-color` | background-color | Checked state indicator color |
| `$bpk-text-primary-day` | `--bpk-checkbox-card-label-color` | color | Label default text color |
| `$bpk-text-on-dark-day` | `--bpk-checkbox-card-label-on-dark-color` | color | Label checked state text color |

### Implementation Pattern

Use `@include utils.bpk-themeable-property()` from `bpk-mixins`:

```scss
@use '../../bpk-mixins/utils';
@use '../../bpk-mixins/tokens';

.bpk-checkbox-card {
  @include utils.bpk-themeable-property(
    background-color,
    --bpk-checkbox-card-default-bg,
    tokens.$bpk-surface-default-day
  );
}

.bpk-checkbox-card--checked {
  @include utils.bpk-themeable-property(
    background-color,
    --bpk-checkbox-card-checked-color,
    tokens.$bpk-core-accent-day
  );
}
```

This enables consumers to override colors at runtime:
```css
.my-custom-theme {
  --bpk-checkbox-card-checked-color: #ff6b35;
  --bpk-checkbox-card-label-color: #333333;
}
```

## Styling Design

**Deliverable**: `styling-guide.md` containing:

1. **CSS Class Structure** (BEM with `bpk-` prefix):
```scss
.bpk-component-name { /* base class */ }
.bpk-component-name--primary { /* variant modifier */ }
.bpk-component-name--disabled { /* state modifier */ }
.bpk-component-name__element { /* child element */ }
```

2. **Sass Imports** (granular from `bpk-mixins`):
```scss
@use '../bpk-mixins/tokens';
@use '../bpk-mixins/typography';
@use '../bpk-mixins/shadows';
@use '../bpk-mixins/borders';
@use '../bpk-mixins/utils';
```

3. **Design Token Mapping**:
   - Map design specs to Backpack tokens
   - Spacing: `tokens.bpk-spacing-*()` (returns rem values)
   - Colors: `tokens.$bpk-color-*`
   - Typography: `typography.bpk-text()`, `typography.bpk-label-1()`, etc.
   - Shadows: `shadows.bpk-box-shadow-*()` mixins
   - Border radius: `tokens.bpk-border-radius-*()` or `borders.bpk-border-radius-*()` mixins

4. **Responsive Behavior**:
   - Define breakpoint behavior (mobile, tablet, desktop)
   - Use Backpack's responsive mixins if applicable

5. **RTL Support**:
   - Document directional properties (margin, padding, text-align)
   - Use logical properties where applicable
   - Test with `isRTL` utility from `bpk-react-utils`

### Storybook Examples

**Deliverable**: Storybook stories in `examples/bpk-component-[name]/` directory:

1. **`stories.tsx`**: Storybook story definitions using CSF 3.0 format
   - Default story with minimal props
   - Stories for all variants and sizes
   - Stories for interactive states (hover, focus, active, disabled)
   - Stories for edge cases (long text, empty states, errors)
   - Accessibility stories demonstrating keyboard navigation

2. **`examples.tsx`**: Example component implementations
   - Reusable example components used by stories
   - Visual demonstrations of all component features
   - Edge case demonstrations

3. **`*.module.scss`** (if needed): Styles for example layouts and demonstrations

**Note**: Examples are written as Storybook stories, not as separate standalone files. All examples are contained within the `examples/bpk-component-[name]/` directory structure.

## Phase 2: Task Breakdown

**Objective**: Create detailed implementation tasks

**Note**: This phase is executed by `/speckit.tasks` command, NOT by `/speckit.plan`

**Deliverable**: `tasks.md` with sequenced implementation tasks organized by:
- Phase 1: Setup (package initialization)
- Phase 2: Core Implementation (component code)
- Phase 3: Styling (SCSS and theming)
- Phase 4: Testing (unit, accessibility, visual)
- Phase 5: Documentation (README, Storybook, JSDoc)
- Phase 6: Integration (Figma Code Connect, package publishing)

## Dependencies

### Internal Backpack Dependencies

**Design Foundations**:
- `@skyscanner/bpk-foundations-web`: Design tokens (colors, spacing, typography)
- `packages/bpk-mixins/`: Sass mixins and utilities

**React Utilities** (if needed):
- `bpk-react-utils`: Portal, cssModules, TransitionInitialMount, isRTL, etc.
- `bpk-theming`: Theming support (if component is themeable)

**Component Dependencies** (if composing with other components):
- List any Backpack components this component uses
- Example: `bpk-component-icon` for icons, `bpk-component-spinner` for loading

### External Dependencies

**Peer Dependencies** (already in project):
- `react: ^18.3.1`
- `react-dom: ^18.3.1`

**Optional Dependencies** (if needed):
- Add any specific external libraries required
- Justify why Backpack's built-in solutions are insufficient

**Development Dependencies** (already in project):
- TypeScript, Jest, Testing Library, jest-axe, etc.

## Testing Strategy

### Unit Tests (`Bpk[ComponentName]-test.tsx`)

**Framework**: Jest 30 + Testing Library

**Test Coverage**:
1. **Rendering Tests**:
   - Renders with required props
   - Renders with optional props
   - Renders all variants (e.g., primary, secondary, tertiary)
   - Renders all sizes (e.g., small, medium, large)
   - Renders with custom className
   - Renders with children

2. **Interaction Tests**:
   - onClick handler called when clicked
   - Keyboard interactions (Enter, Space)
   - Focus management

3. **State Tests**:
   - Disabled state prevents interactions
   - Loading state (if applicable)
   - Error state (if applicable)

4. **Edge Cases**:
   - No props provided (uses defaults)
   - Null/undefined children
   - Extremely long text
   - Invalid prop values (should gracefully handle or error)

5. **Snapshot Tests**:
   - Snapshot for each variant + size combination
   - Snapshot for disabled state
   - Snapshot for edge cases

**Coverage Target**: 70% branches, 75% functions/lines/statements

### Accessibility Tests (`accessibility-test.tsx`)

**Framework**: jest-axe

**Test Coverage**:
1. **Automated Checks**:
   - No accessibility violations detected by axe
   - Test all variants and states
   - Test with different content (text, icons, etc.)

2. **ARIA Attributes**:
   - Correct role (if applicable)
   - aria-label or aria-labelledby present when needed
   - aria-disabled for disabled state
   - aria-pressed for toggle buttons (if applicable)

3. **Keyboard Navigation**:
   - Tab to focus component
   - Enter/Space to activate (if interactive)
   - Focus visible (outline or focus indicator)

4. **Screen Reader**:
   - Test that component announces correctly
   - Test state changes are announced
   - Test with actual screen readers (manual testing)

**Important**: Test the public interface. If component is composed (e.g., `BpkAccordion` with `BpkAccordionItem`), test them together as they would be used by consumers.

### Visual Regression Tests (Percy via Storybook)

**Framework**: Percy + Storybook

**Test Coverage** (if component does NOT use images):
1. All visual variants (primary, secondary, tertiary)
2. All sizes (small, medium, large)
3. Interactive states (hover, focus, active, disabled)
4. Edge cases (long text, empty, error states)
5. Responsive breakpoints (mobile, tablet, desktop)
6. RTL rendering

**Exception**: If component uses images (e.g., `BpkImage`, `BpkCard` with images), do NOT add visual tests. Per `decisions/visual-tests.md`, image loading is flaky on CI and causes false positives.

### Integration Tests (if applicable)

**Framework**: Jest + Testing Library

**Test Coverage** (only if component composes with other components):
- Test integration with other Backpack components
- Test theming integration (if themeable)
- Test in realistic usage scenarios

## Documentation Requirements

### README.md (British English prose, <100 words)

**Structure**:
1. **Title**: Component name in sentence case (e.g., "Bar chart")
2. **Description**: Plain English, describe purpose (not configuration)
3. **Installation**: `npm install @skyscanner/backpack-web`
4. **Usage**: Code example with basic usage
5. **Props**: Table with prop name, type, default, description
6. **Browser Support**: Link to browser support info
7. **Accessibility**: Brief note on accessibility features
8. **Related Components**: Links to related Backpack components
9. **Figma**: Link to Figma designs

**Example**:
```markdown
# Bar chart

A simple bar chart component for displaying data visually with customisable
colours and labels. Ideal for presenting comparative data in a clear format.

## Installation

npm install @skyscanner/backpack-web

## Usage

import BpkBarchart from '@skyscanner/backpack-web/bpk-component-barchart';

<BpkBarchart data={chartData} />

[Props table, examples, etc.]
```

### Storybook Stories (`examples/bpk-component-[name]/stories.tsx`)

**Stories to include**:
1. **Default**: Basic usage with minimal props
2. **Variants**: All visual variants (primary, secondary, tertiary)
3. **Sizes**: All sizes (small, medium, large)
4. **States**: Interactive states (hover, focus, active, disabled)
5. **With Content**: With children, icons, or other content
6. **Edge Cases**: Long text, empty, error states
7. **Responsive**: Mobile, tablet, desktop views
8. **Accessibility**: Keyboard navigation demo, screen reader support

**Storybook Configuration**:
- Use CSF (Component Story Format) 3.0
- Add a11y addon for accessibility checks
- Use controls for interactive prop editing
- Add JSDoc comments to stories for documentation

**Example**:
```typescript
import type { Meta, StoryObj } from '@storybook/react';
import Bpk[ComponentName] from './Bpk[ComponentName]';

const meta: Meta<typeof Bpk[ComponentName]> = {
  title: 'Components/Bpk[ComponentName]',
  component: Bpk[ComponentName],
};

export default meta;
type Story = StoryObj<typeof Bpk[ComponentName]>;

export const Default: Story = {
  args: {
    variant: 'primary',
  },
};

export const AllVariants: Story = {
  render: () => (
    <>
      <Bpk[ComponentName] variant="primary">Primary</Bpk[ComponentName]>
      <Bpk[ComponentName] variant="secondary">Secondary</Bpk[ComponentName]>
      <Bpk[ComponentName] variant="tertiary">Tertiary</Bpk[ComponentName]>
    </>
  ),
};
```

### JSDoc/TSDoc Comments

**Requirements**:
- Every component must have a JSDoc comment
- Every prop must be documented
- Use `@deprecated` for deprecated props
- Include examples in JSDoc where helpful
- Use British English for prose, US English for code

**Example**:
```typescript
/**
 * Bpk[ComponentName] is a component for [purpose].
 *
 * It supports multiple variants (primary, secondary, tertiary) and sizes.
 *
 * @example
 * <Bpk[ComponentName] variant="primary" size="medium">
 *   Click me
 * </Bpk[ComponentName]>
 */
type Bpk[ComponentName]Props = {
  /**
   * Visual variant of the component.
   */
  variant: 'primary' | 'secondary' | 'tertiary';

  /**
   * Size of the component.
   * @default 'medium'
   */
  size?: 'small' | 'medium' | 'large';

  /**
   * Whether the component is disabled.
   * @default false
   */
  disabled?: boolean;

  /**
   * @deprecated Use `size` prop instead. Will be removed in v11.0.0.
   */
  large?: boolean;
};
```

### Figma Code Connect (`.figma.tsx`)

**Purpose**: Connect component to Figma designs for design-to-code workflow

**Example**:
```typescript
import { figma } from '@figma/code-connect';
import Bpk[ComponentName] from './Bpk[ComponentName]';

figma.connect(Bpk[ComponentName], 'https://www.figma.com/file/...', {
  props: {
    variant: figma.enum('Variant', {
      Primary: 'primary',
      Secondary: 'secondary',
      Tertiary: 'tertiary',
    }),
    size: figma.enum('Size', {
      Small: 'small',
      Medium: 'medium',
      Large: 'large',
    }),
    disabled: figma.boolean('Disabled'),
  },
  example: (props) => <Bpk[ComponentName] {...props}>Label</Bpk[ComponentName]>,
});
```

## Migration & Versioning

### Version Determination (per `decisions/versioning-rules.md`)

**This component is**: [Select one]
- [ ] **NEW COMPONENT** → **MINOR** version bump for `@skyscanner/backpack-web`
- [ ] **MAJOR UPDATE** → **MAJOR** version bump (breaking API/visual changes)
- [ ] **ENHANCEMENT** → **MINOR** version bump (new optional features)
- [ ] **BUG FIX** → **PATCH** version bump

**Rationale**: [Explain why this version bump according to versioning rules]

### Breaking Changes (if MAJOR)

**API Changes**:
- [Old API] → [New API]
- [Prop removed] → [Alternative]
- [Behavior changed] → [New behavior]

**Visual Changes**:
- [Old appearance] → [New appearance]
- [Token change] → [Impact]

**Migration Guide**:
```typescript
// Before (old API)
<Bpk[ComponentName] oldProp="value" />

// After (new API)
<Bpk[ComponentName] newProp="value" />
```

**Timeline**: [Date when breaking change will be released]

### Deprecations (if applicable)

**Deprecated APIs** (minimum 3 months before removal):
- `oldProp` → Use `newProp` instead
- `OldComponent` → Use `NewComponent` instead

**Deprecation Implementation**:
```typescript
type Bpk[ComponentName]Props = {
  newProp: string;

  /**
   * @deprecated oldProp is deprecated. Use newProp instead. Will be removed in v11.0.0.
   */
  oldProp?: string;
};

const Bpk[ComponentName] = ({ newProp, oldProp }: Bpk[ComponentName]Props) => {
  if (oldProp) {
    console.warn('oldProp is deprecated. Use newProp instead. Will be removed in v11.0.0.');
  }

  const effectiveProp = newProp || oldProp;
  // ...
};
```

### Future API (if applicable)

**Opt-in V2 Component** (minimum 3 months before becoming default):
- `Bpk[ComponentName]` (current) → `Bpk[ComponentName]V2` (future)
- Consumers can opt-in to V2 early
- In next MAJOR version, V2 becomes default and V1 is removed

**Example**:
```typescript
// Current usage
import Bpk[ComponentName] from '@skyscanner/backpack-web/bpk-component-name';

// Opt-in to future API
import Bpk[ComponentName]V2 from '@skyscanner/backpack-web/bpk-component-name/Bpk[ComponentName]V2';
```

## Release Checklist

Before releasing this component:

- [ ] All constitution checks pass
- [ ] All tests pass (unit, accessibility, visual)
- [ ] Test coverage meets thresholds (70% branches, 75% functions/lines/statements)
- [ ] TypeScript compiles without errors
- [ ] ESLint and Stylelint pass
- [ ] README.md is complete and accurate
- [ ] Storybook stories are comprehensive
- [ ] JSDoc comments are complete
- [ ] Figma Code Connect is implemented
- [ ] Component works in all supported browsers
- [ ] Component is keyboard accessible
- [ ] Component works with screen readers
- [ ] Component supports RTL languages
- [ ] Version bump is correct (MAJOR/MINOR/PATCH)
- [ ] Changelog is updated
- [ ] PR is approved and merged
- [ ] Package is published to npm
- [ ] Storybook is deployed

## Notes

### Key Backpack Patterns to Follow

1. **CSS Modules**: Always use `.module.scss` for component styles
2. **Modern Sass**: Use `@use` syntax, never `@import`
3. **Granular Imports**: Import specific mixins, not entire package
4. **Design Tokens**: Use tokens for all values (colors, spacing, typography)
5. **rem Units**: Always use `rem` for sizing, never `px` or `em`
6. **BEM Classes**: Use `bpk-component-name--modifier` pattern
7. **TypeScript**: All code in TypeScript, generate `.d.ts` files
8. **Accessibility**: Test with jest-axe, ensure keyboard nav and ARIA
9. **British English**: Prose in British English, code in US English
10. **Documentation**: <100 words, sentence case, singular titles

### Common Pitfalls to Avoid

1. ❌ Using `@import` in SCSS → ✅ Use `@use`
2. ❌ Using `px` units → ✅ Use `rem` units
3. ❌ Importing entire `bpk-mixins` → ✅ Import specific modules
4. ❌ Not namespacing mixins → ✅ Use `tokens.bpk-spacing-md()`
5. ❌ Skipping accessibility tests → ✅ Always include jest-axe tests
6. ❌ Using American English in docs → ✅ Use British English
7. ❌ Missing `@deprecated` tags → ✅ Document all deprecations
8. ❌ No runtime warnings for deprecated props → ✅ Add console.warn
9. ❌ Visual tests for image components → ✅ Skip visual tests if uses images
10. ❌ Testing implementation details → ✅ Test public interface

## References

- **Backpack Constitution**: `.specify/memory/constitution.md`
- **Architecture Decisions**: `decisions/` directory
- **Component Examples**: Browse `packages/` for similar components
- **Design Tokens**: `@skyscanner/bpk-foundations-web` and `packages/bpk-mixins/`
- **React Utilities**: `packages/bpk-react-utils/`
- **Theming**: `packages/bpk-theming/`
- **Storybook Examples**: `examples/` directory
- **Testing Patterns**: Review test files in existing components
